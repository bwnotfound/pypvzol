# Python implementation of 植物大战僵尸 ol 助手

使用 Python 实现的植物大战僵尸 ol 助手，具有一些原有助手没有的功能。

## 介绍

本项目目的是实现原有助手没有但十分有必要的功能，例如自动练级，自动进化，自动合成，自动使用更多物品，自动购买更多物品等等。

注意，如果你的资源并不富裕（例如血瓶较少，战力低不能秒杀洞口等），最好少练级，因为这样会损失大量血瓶，同时练级缓慢。推荐血瓶较多的同时可以秒杀公洞第三层的怪（固定 3 个怪，方便练级）时使用练级功能。

目前支持的功能有自动练级（优先高等级炮灰打高等级洞口），自动进化（可以自主设置进化路线）

**请一定要看使用提醒**

由于带有一定的练手性质，所以代码可能较为混乱，同时更新随缘。

## 声明

本项目为开源项目，项目的贡献者不知道所有用户的输入，因此不负责任何用户的输入。因使用本项目而造成的任何损失和影响都与本项目贡献者无关，用户需对自己的操作负责。本项目仅供学习交流使用，不得用于商业用途，否则后果自负。

## 使用规约

1.  本项目是基于学术交流目的建立，仅供交流与学习使用，并非为生产环境准备。
2.  任何基于本项目制作的视频都必须在简介中声明项目来源。
3.  不可用本项目进行网络攻击。
4.  禁止使用该项目从事违法行为与宗教、政治等活动，该项目维护者坚决抵制上述行为，不同意此条则禁止使用该项目。
5.  继续使用视为已同意本仓库 README 所述相关条例，本仓库 README 已进行劝导义务，不对后续可能存在问题负责。
6.  如果将此项目用于任何其他企划，请提前联系并告知本仓库作者，十分感谢。

## 使用提醒

1.  1~11 区是一定使用不了的，需要注意
2.  **由于我只有 24 区和 46 区的账号，因此其它区没有测试过，可能会有 bug。** 如果有 bug 请提交 issue 或者 pr。
3.  建议看控制台(cmd)的输出，因为报错信息并不会全部都在日志面板上显示（尤其是 46 区这些新区由快速访问造成的 418 问题，418 后只能等一会再来）
4.  目前还没打算整个 Release 版本，所以你需要对 python 有一定了解，要能自行跑通这个项目

## 使用方法

目前主要是自动回血与练级

1.  要删除列表物品，选中物品并按“删除键(Delete)或者“退格键(Backspace)”即可
2.  练级功能设置上，默认是每次挑战前利用设置的血瓶为血量为 0 的所有植物回血。所有主力均会出战，炮灰与洞口等级差大于等于 5 的会出战，同时优先使用更高等级的炮灰。
3.  进化功能中首先点击"功能面板"，在里面选中"进化路线面板"按钮，然后选中植物列表中的一个植物再点击"添加进化路线"，然后选中列表中新出现的进化路线再点击"修改进化路线"，直接点击右边列表元素即可添加进化路线元素，若想删除路线元素，在左边列表选中想要删除的元素并按“删除键(Delete)或者“退格键(Backspace)”即可。如果想要删除进化路线，选中对应进化路线点击"删除进化路线即可"。最后，点击想要进化的植物和对应的进化路线按"开始进化"按钮即可开始进化。

### 环境配置

我用的是 python3.10.6 版本，暂未测试其他版本。需要 python3.10.6 版本的请到 https://www.python.org/downloads/release/python-3106/ 下载，或者直接点击 https://www.python.org/ftp/python/3.10.6/python-3.10.6-amd64.exe 下载

### 运行源码

```shell
# 安装依赖。如果可以的话，建议使用虚拟环境venv
$ pip install -r requirements.txt
```

安装完环境后，打开根目录下的 config 文件夹，修改其中的 config.json 文件，将 region 改为你所在的区号，将 cookie 改为你的 cookie 值。cookie 获取可以在植物大战僵尸 ol 网页版登录后，按 F12 打开开发者工具，在上方工具栏中点击“控制台”，然后下方输入`document.cookie`，回车，即可获取到 cookie 值。如果你用了原有助手，那么把原有助手的 Config 文件夹下你对应区的 xml 文件打开，搜索`UserCookies`也能获取到 cookie 值。

将 cookie 值复制到 config.json 文件中的 cookie 值中，注意不要删除引号，也不要有多余的引号。最后保存文件。

配置完成后，在根目录下打开控制台，输入`python webUI.py`并回车即可运行。（如果配置了虚拟环境，需要切换到虚拟环境后再运行上述代码）

### 其他注意事项

1.  如果要切换账号，不仅需要重新配置 config.json 文件，还需要删除根目录下的 data 文件（因为还没做多人设置）。
2.  46 区的服务器对于访问有频率限制，所以如果你的账号是 46 区的，那么这个助手大概率是不好用的。
    用过老助手的也都知道，请求发送太快会 418，实际上就是暂时被 ban 掉了。（有待测试是封禁 ip 还是封禁对应 cookie）
3.  46 区服务器依托答辩，很卡，所以请耐心等待，同时如果等待时间超过 15s，那么大概率是 418 了，请等待一段时间再使用
4.  除了 24 和 46 区测试过外（实际上是新老区的区别），其它区没号就没有测试，所以有 bug 请提交 issue 或者 pr。(1 区这样的老区暂时不会去管，因为 api 不一样，有空再说吧)

## 后话

~~关注 B 站[蓝白 bw](https://space.bilibili.com/107433411)喵， 关注[蓝白 bw](https://space.bilibili.com/107433411)谢谢喵~~

### Q&A

1.  Q: 为什么要叠这么多甲呢？

    A: 别问，问就是没版权爱发电。

2.  Q: 为什么要为这个凉透了的游戏写个助手呢？

    A: ~~因为我想写，所以我写了。~~ 其实主要是是练手，当然也是因为我还算是比较喜欢这个游戏。既然暂时还没有被强登，同时也处于快速上升期，那就索性安安心心地当休闲养老游戏了。

3.  Q: 为什么有助手了还要写一个呢？

    A: 原来助手没有练级功能(强行练级很低效)，也没有自定义进化(不想买)，于是干脆自己写一个

4.  Q: 还玩这 sb 游戏呢？

    A: 还真是

## Bug list:

列一些知道但暂时还没去管的 bug

1.  老区（例如 1 区）和新区的 api 不一致，例如 url 中是"pvz-"开头的
2.  暂未添加血瓶选择功能，所以主力植物不强的话可能会死，Log 文本框还未与主线程独立，会卡死，各个挑战次数统计还未实现，
    所以每次打开都会重新计算
3.  暂时未添加多人配置设置，所以一次暂时只能添加一个人的设置，换成另外一个人后就只能重新设置
4.  46 区的回血设置容易失败，暂时不知道原理，所以加了个多次尝试试图减少 bug

## TODO LIST:

1.  移植 scripts 中的代码到 webUI 中
2.  重构代码，使代码更加规范化
3.  支持刷级自动使用时之沙
4.  支持难度选择
5.  添加自动合成
6.  添加自动刷品
7.  添加自动使用更多物品
8.  添加自动购买更多物品
